import ssdeep
import os


def ssdeep_hash(file_path):
    with open(file_path, 'rb') as f:
        return ssdeep.hash(f.read())


ssdeep_hash_path = '/home/parallels/PycharmProjects/R_and_D_Project/src/text_files/combined_hashes.txt'


def scan_file(file_path):
    file_hash = ssdeep_hash(file_path)
    with open(ssdeep_hash_path, 'r') as f:
        score = 0
        matching_file = ''
        for line in f:
            line = line.strip()
            compare = ssdeep.compare(file_hash, line)
            if compare > 0:
                score = compare
                matching_file = line
            # if compare > score:
            #     score = compare
            #     matching_file = line

    if score < 20:
        likelihood = 0
    elif 20 < score < 70:
        likelihood = 0.5
    elif score > 70:
        likelihood = 1

    return {
        'file_path': file_path,
        'score': score,
        'ssdeep_hash': file_hash,
        'likelihood': likelihood
    }

# scan_file('path/to/file/')


# <------------------ Presentation Screenshots Code ------------------>

# mal_files = 0
# ben_files = 0
# path_to_file_mal = '/Users/parjanyapandey/College Stuff/Semester 6/R&D Work/Dataset/DikeDataset/files/malware'
# path_to_file_ben = '/Users/parjanyapandey/College Stuff/Semester 6/R&D Work/Dataset/DikeDataset/files/benign'
#
#
#
#
# for file in os.listdir(path_to_file_mal):
#     if mal_files == 6:
#         break
#     file_path = os.path.join(path_to_file_mal, file)
#     if os.path.isfile(file_path):
#         scan_file(file_path)
#         print()
#         print("---------------------------------------------------")
#         print()
#     mal_files += 1
#
# for file in os.listdir(path_to_file_ben):
#     if ben_files == 6:
#         break
#     file_path = os.path.join(path_to_file_ben, file)
#     if os.path.isfile(file_path):
#         scan_file(file_path)
#         print()
#         print("---------------------------------------------------")
#         print()
#     ben_files += 1
